<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>NAई बहु</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts - Playfair Display and Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400..900;1,400..900&family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            width: 100%;
            overflow-x: hidden;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #A40046;
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.07'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            color: white;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            width: 100%;
            max-width: 100vw;
            overflow-x: hidden;
            position: relative;
        }

        .royal-font {
            font-family: 'Playfair Display', serif;
        }
        
        /* Splash Screen Animations */
        @keyframes splash-enter {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .splash-enter-active {
            animation: splash-enter 1s ease-in-out forwards;
        }

        @keyframes blur-to-visible {
            0% {
                opacity: 0;
                filter: blur(10px);
                transform: scale(0.9);
            }
            100% {
                opacity: 1;
                filter: blur(0);
                transform: scale(1);
            }
        }
        .logo-animation {
            animation: blur-to-visible 1.5s forwards;
        }

        /* Cart Scrollbar */
        .cart-items-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .cart-items-scrollbar::-webkit-scrollbar-thumb {
            background-color: #cbd5e1;
            border-radius: 4px;
        }
        .cart-items-scrollbar::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        
        /* Category Modal Animations */
        @keyframes fade-in {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes scale-up {
            from { transform: scale(0.95); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        .animate-fade-in {
            animation: fade-in 0.3s ease-out forwards;
        }
        .animate-scale-up {
            animation: scale-up 0.3s ease-out forwards;
        }
        
    </style>
<link rel="stylesheet" href="/index.css">
</head>

<body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>

    <script type="module">
        // --- CONSTANTS ---
        const GOOGLE_APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwr1_9lc-dqmQMLOsrZyur1lGSP19bR3loVGQU0-ZM4f0XTILJ9UYWHqy9zHwpPLwmEEg/exec'; // IMPORTANT: Replace with your actual Google Apps Script URL
        
        // To add more tables, change the line below, for example: const TABLE_NUMBERS = [1, 2, 3, 4, 5];
        const TABLE_NUMBERS = [1];

        const MENU = [
            // Starters
            { id: 1, name: 'Paneer Tikka', price: 250, description: 'Cubes of paneer marinated in spices and grilled in a tandoor.', image: 'https://images.unsplash.com/photo-1567188040759-fb8a873dc6d8?auto=format&fit=crop&q=80&w=1587', category: 'Starters', searchTerms: ['paneer', 'tikka', 'appetizer', 'veg', 'vegetarian'], },
            { id: 2, name: 'Hara Bhara Kabab', price: 220, description: 'A vegetarian kabab made with spinach, potatoes, and green peas.', image: 'https://images.unsplash.com/photo-1606843048322-c5c6d1f3f6c4?auto=format&fit=crop&q=80&w=1587', category: 'Starters', searchTerms: ['kabab', 'kebab', 'spinach', 'veg', 'vegetarian'], },
            // Main Course
            { id: 3, name: 'Butter Chicken', price: 450, description: 'Grilled chicken cooked in a smooth buttery & creamy tomato based gravy.', image: 'https://images.unsplash.com/photo-1565299624946-b28f40a0ae38?auto=format&fit=crop&q=80&w=1081', category: 'Main Course', searchTerms: ['murgh makhani', 'chicken', 'non-veg', 'curry'], },
            { id: 4, name: 'Dal Makhani', price: 350, description: 'A classic Indian dish made with whole black lentils, red kidney beans, butter and cream.', image: 'https://images.unsplash.com/photo-1598515213692-5f284145df1a?auto=format&fit=crop&q=80&w=1587', category: 'Main Course', searchTerms: ['dal', 'lentils', 'veg', 'vegetarian', 'curry'], },
            { id: 10, name: 'Shahi Paneer', price: 400, description: 'Cottage cheese in a thick, creamy and spicy gravy prepared in tomato, onions and cashew nuts paste.', image: 'https://images.unsplash.com/photo-1565557623262-b27e25248540?auto=format&fit=crop&q=80&w=1626', category: 'Main Course', searchTerms: ['paneer', 'cheese', 'creamy', 'veg', 'vegetarian'], },
            // Breads
            { id: 5, name: 'Garlic Naan', price: 80, description: 'Soft Indian flatbread topped with garlic and butter.', image: 'https://images.unsplash.com/photo-1598114992523-2a5b157c66e2?auto=format&fit=crop&q=80&w=1587', category: 'Breads', searchTerms: ['naan', 'bread', 'roti', 'veg'], },
            { id: 11, name: 'Tandoori Roti', price: 40, description: 'A traditional Indian flatbread made from whole wheat flour, baked in a tandoor.', image: 'https://images.unsplash.com/photo-1626776876722-bab414a3833b?auto=format&fit=crop&q=80&w=1587', category: 'Breads', searchTerms: ['roti', 'bread', 'tandoor', 'veg'], },
            // Desserts
            { id: 6, name: 'Gulab Jamun', price: 150, description: 'Soft, spongy balls made of milk solids, soaked in rose-scented syrup.', image: 'https://images.unsplash.com/photo-1563729784474-d77dbb933a9e?auto=format&fit=crop&q=80&w=751', category: 'Desserts', searchTerms: ['sweet', 'dessert', 'mithai', 'veg'], },
            { id: 12, name: 'Jalebi', price: 120, description: 'A spiral-shaped sweet made by deep-frying a wheat flour batter, then soaked in sugar syrup.', image: 'https://images.unsplash.com/photo-1610421235948-f02be96b37f8?auto=format&fit=crop&q=80&w=1587', category: 'Desserts', searchTerms: ['sweet', 'dessert', 'jalebi', 'veg'], },
            // Beverages
            { id: 7, name: 'Masala Chai', price: 100, description: 'Indian tea with aromatic herbs and spices.', image: 'https://images.unsplash.com/photo-1551030173-1a29f83e8431?auto=format&fit=crop&q=80&w=1587', category: 'Beverages', searchTerms: ['tea', 'chai', 'hot drink', 'veg'], },
            { id: 13, name: 'Lassi', price: 120, description: 'A creamy, frothy yogurt-based drink, blended with water and various fruits or seasonings.', image: 'https://images.unsplash.com/photo-1598605235805-2d85b6b3b52b?auto=format&fit=crop&q=80&w=1587', category: 'Beverages', searchTerms: ['lassi', 'yogurt', 'drink', 'veg'], },
        ];

        const popularSearches = ['Paneer', 'Chicken', 'Naan', 'Dal Makhani', 'Chai', 'Lassi'];
        const searchSuggestions = [...new Set(MENU.flatMap(item => [item.name, ...item.searchTerms, item.category]))];
        const categoryImages = {
            'All': 'https://images.unsplash.com/photo-1555939594-58d7cb561ad1?auto=format&fit=crop&q=80&w=1587',
            'Starters': 'https://images.unsplash.com/photo-1541592106381-b31e9677c0e5?auto=format&fit=crop&q=80&w=1587',
            'Main Course': 'https://images.unsplash.com/photo-1565299624946-b28f40a0ae38?auto=format&fit=crop&q=80&w=1081',
            'Breads': 'https://images.unsplash.com/photo-1598114992523-2a5b157c66e2?auto=format&fit=crop&q=80&w=1587',
            'Desserts': 'https://images.unsplash.com/photo-1563729784474-d77dbb933a9e?auto=format&fit=crop&q=80&w=751',
            'Beverages': 'https://images.unsplash.com/photo-1551030173-1a29f83e8431?auto=format&fit=crop&q=80&w=1587',
        };

        // --- STATE MANAGEMENT ---
        let state = {
            showSplash: true,
            cart: {},
            isCartOpen: false,
            isSearchOpen: false,
            tableNumber: TABLE_NUMBERS[0] || '',
            message: null,
            previousOrder: JSON.parse(localStorage.getItem('previousOrder')) || null,
            activeCategory: 'All',
            searchResults: null,
            searchQueryDisplay: '',
            isCategoryModalOpen: false,
            isFloatingCategoryButtonVisible: false,
            isFloatingCartButtonVisible: false,
            orderJustSent: false,
        };

        const root = document.getElementById('root');

        // --- RENDER FUNCTIONS (Component Equivalents) ---

        const SplashScreen = () => `
            <div id="splash-screen" class="fixed top-0 left-0 w-screen h-screen bg-[#f2e3e3] flex justify-center items-center z-[1000] splash-enter-active">
                <div class="flex justify-center items-center h-full w-full p-4 max-w-full logo-animation">
                    <img src="Logo2.png" alt="Nai Bahu Logo" class="max-w-[80%] max-h-[50vh] h-auto block" />
                </div>
            </div>
        `;

        const Header = ({ tableNumber, cartCount }) => `
            <header class="sticky top-0 z-40 shadow-lg text-white w-full bg-[#A40046] border-b-2 border-[#C0A062]/60">
                <nav class="container mx-auto px-2 sm:px-4 lg:px-8 py-2 sm:py-4 flex justify-between items-center">
                    <a href="#" class="flex items-center space-x-1 sm:space-x-2 flex-shrink-0">
                        <img src="naibahu.png" alt="Logo" class="h-6 sm:h-8 lg:h-10 w-auto" />
                        <span class="font-extrabold text-sm sm:text-lg lg:text-xl royal-font">NAई बहु</span>
                    </a>
                    <div class="flex items-center space-x-1 sm:space-x-2 lg:space-x-4">
                        <div class="flex items-center space-x-1">
                            <label for="table-number-select" class="text-sm font-medium hidden sm:inline">Table No:</label>
                             <select id="table-number-select" class="w-24 sm:w-28 p-1 sm:p-2 text-sm border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-rose-500 transition-colors text-black bg-white">
                                ${TABLE_NUMBERS.map(num => `<option value="${num}" ${tableNumber == num ? 'selected' : ''}>Table ${num}</option>`).join('')}
                            </select>
                        </div>
                        <button id="search-btn" class="relative p-2 sm:p-2.5 rounded-xl hover:bg-[#830038] transition-colors">
                            <svg class="w-5 h-5 sm:w-6 sm:h-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                        </button>
                        <button id="cart-btn" class="relative p-2 sm:p-2.5 rounded-xl hover:bg-[#830038] transition-colors">
                            <svg class="w-5 h-5 sm:w-6 sm:h-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path></svg>
                            ${cartCount > 0 ? `<span class="absolute top-0 right-0 inline-flex items-center justify-center px-1.5 py-0.5 text-xs font-bold leading-none text-white transform translate-x-1/2 -translate-y-1/2 bg-rose-600 rounded-full">${cartCount}</span>` : ''}
                        </button>
                    </div>
                </nav>
            </header>
        `;

        const MenuItemCard = ({ item }) => `
            <div class="bg-[#F5EFE6] rounded-lg shadow-lg overflow-hidden transform transition-all duration-300 hover:shadow-xl hover:-translate-y-1 flex flex-col border-2 border-[#C0A062]/50">
                <div class="p-5 sm:p-6 flex-grow flex flex-col">
                    <h3 class="text-xl sm:text-2xl font-bold royal-font mb-2 text-[#A40046]">${item.name}</h3>
                    <p class="text-[#5D4037] text-sm mb-4 line-clamp-2 flex-grow min-h-[40px]">${item.description}</p>
                    <div class="flex justify-between items-center mt-auto">
                        <span class="text-2xl sm:text-3xl font-bold font-sans text-[#5D4037]">
                            <span class="text-base font-normal align-middle mr-1">₹</span>${item.price}
                        </span>
                        <button class="add-to-cart-btn bg-[#A40046] text-white px-5 py-2 rounded-full font-bold shadow-lg hover:bg-[#830038] transition-colors text-sm flex items-center gap-2 transform hover:scale-105" data-item-id="${item.id}">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                            <span>Add</span>
                        </button>
                    </div>
                </div>
            </div>
        `;

        const MenuSection = ({ activeCategory, searchResults, searchQueryDisplay, filteredMenu }) => {
            const itemsToDisplay = searchResults !== null ? searchResults : filteredMenu;
            return `
                <div class="lg:col-span-2">
                    ${searchResults !== null ? `
                        <div class="flex justify-between items-center mb-4 sm:mb-6">
                            <h2 class="text-xl sm:text-2xl lg:text-3xl font-bold royal-font">Search Results for "${searchQueryDisplay}"</h2>
                            <button id="clear-search-btn" class="text-sm text-rose-300 hover:text-white transition-colors">Clear Search</button>
                        </div>
                    ` : `
                        <div class="flex justify-between items-center mb-4 sm:mb-6">
                            <h2 class="text-xl sm:text-2xl lg:text-3xl font-bold royal-font">Explore Our Menu</h2>
                            <button id="category-modal-trigger" class="flex items-center gap-2 bg-[#F5EFE6] text-[#A40046] px-4 py-2 rounded-full font-bold shadow-md hover:bg-white transition-colors transform hover:scale-105 border-2 border-[#C0A062]/50">
                                <span>${activeCategory}</span>
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>
                            </button>
                        </div>
                    `}
                    
                    ${itemsToDisplay.length > 0 ? `
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-2 xl:grid-cols-3 gap-4 sm:gap-6 lg:gap-8">
                            ${itemsToDisplay.map(item => MenuItemCard({ item })).join('')}
                        </div>
                    ` : `
                        <div class="text-center py-10 sm:py-20 px-4 col-span-full">
                            <p class="text-lg text-gray-300">No items found for "${searchQueryDisplay}". Try a different search!</p>
                        </div>
                    `}
                </div>
            `;
        };
        
        const CategoryModal = ({ isOpen, activeCategory }) => {
            if (!isOpen) return '';
            const categories = ['All', ...new Set(MENU.map(item => item.category))];
            return `
                <div id="category-modal-overlay" class="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4 animate-fade-in">
                    <div class="bg-[#F5EFE6] rounded-2xl p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto animate-scale-up">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-2xl royal-font font-bold text-[#5D4037]">Select a Category</h3>
                            <button id="category-modal-close" class="p-2 rounded-full hover:bg-gray-200 text-gray-600 transition-colors">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg>
                            </button>
                        </div>
                        <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                            ${categories.map(category => `
                                <div class="category-select-item relative rounded-lg overflow-hidden shadow-lg h-32 md:h-48 cursor-pointer group transform transition-transform duration-300 hover:scale-105" data-category="${category}">
                                    <img src="${categoryImages[category]}" alt="${category}" class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-110"/>
                                    <div class="absolute inset-0 bg-gradient-to-t from-black/70 to-transparent"></div>
                                    <h4 class="absolute bottom-4 left-4 text-white text-lg md:text-xl font-bold royal-font">${category}</h4>
                                    ${activeCategory === category ? `
                                        <div class="absolute top-2 right-2 bg-white text-[#A40046] rounded-full p-1.5">
                                             <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
                                        </div>
                                    ` : ''}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        };

        const FollowUsSection = () => `
            <div class="text-center py-8 px-4 flex flex-col items-center animate-fade-in">
                <h4 class="text-lg font-bold royal-font text-[#A40046]">Thank You For Your Order!</h4>
                <p class="text-gray-600 text-sm mt-2 mb-6">We hope you enjoyed your meal.</p>
                <div class="w-full border-t border-gray-300 my-4"></div>
                <h5 class="font-semibold text-gray-700 mb-4">Follow Us & Stay in Touch</h5>
                <div class="flex items-center justify-center space-x-6 mb-6">
                    <a href="https://instagram.com" target="_blank" rel="noopener noreferrer" class="text-gray-600 hover:text-[#A40046] transition-colors transform hover:scale-110">
                        <svg class="w-8 h-8" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line></svg>
                    </a>
                    <a href="https://facebook.com" target="_blank" rel="noopener noreferrer" class="text-gray-600 hover:text-[#A40046] transition-colors transform hover:scale-110">
                        <svg class="w-8 h-8" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.878V14.89h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.243 0-1.63.771-1.63 1.562V12h2.773l-.443 2.89h-2.33v6.988C18.343 21.128 22 16.991 22 12z"></path></svg>
                    </a>
                </div>
                <div class="flex items-center text-gray-600">
                     <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg>
                    <span class="ml-2 font-medium">+91 12345 67890</span>
                </div>
            </div>
        `;

        const CartSidebar = ({ isOpen, cart, previousOrder, message, orderJustSent }) => {
            const items = Object.values(cart);
            const total = items.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            
            return `
                <aside class="fixed top-0 right-0 w-full sm:max-w-sm md:max-w-md h-full bg-[#F5EFE6] text-[#5D4037] z-50 transform transition-transform duration-300 ease-in-out ${isOpen ? 'translate-x-0' : 'translate-x-full'} lg:sticky lg:top-24 lg:transform-none lg:h-auto lg:max-h-[calc(100vh-120px)] p-3 sm:p-4 lg:p-6 rounded-l-2xl lg:rounded-2xl shadow-2xl flex flex-col">
                    ${previousOrder && !orderJustSent ? `
                        <div class="mb-3 sm:mb-4 lg:mb-6">
                            <h3 class="text-base sm:text-lg lg:text-xl royal-font font-semibold mb-2">Previous Order</h3>
                            <div class="p-2 sm:p-3 lg:p-4 bg-[#EAE3D9] rounded-xl border border-gray-300">
                                <p class="text-gray-500 text-xs mb-2">Order from ${new Date(previousOrder.timestamp).toLocaleDateString()}</p>
                                ${previousOrder.items.map(item => `<div key="${item.id}" class="flex justify-between text-xs sm:text-sm"><span class="text-gray-600">${item.name} x ${item.quantity}</span><span class="font-medium text-gray-700">₹${item.price * item.quantity}</span></div>`).join('')}
                                <div class="flex justify-between font-bold text-sm sm:text-base mt-2 pt-2 border-t border-gray-300"><span>Total</span><span>₹${previousOrder.total}</span></div>
                            </div>
                        </div>
                    ` : ''}
                    <div class="flex justify-between items-center mb-3 sm:mb-4 lg:mb-6">
                        <h3 class="text-lg sm:text-xl lg:text-2xl royal-font font-semibold">Your Order</h3>
                        <button id="cart-close-btn" class="lg:hidden p-2 rounded-full hover:bg-gray-200 transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg>
                        </button>
                    </div>
                    <div class="flex-grow overflow-y-auto min-h-0 space-y-2 sm:space-y-3 cart-items-scrollbar pr-2">
                        ${items.length === 0 ? (orderJustSent ? FollowUsSection() : `<div class="text-center text-gray-500 py-8">Your cart is empty.</div>`) : items.map(item => `
                            <div class="flex items-center justify-between border-b border-gray-200 pb-2 sm:pb-3 last:border-b-0 last:pb-0">
                                <div class="flex-1 min-w-0"><p class="font-medium text-sm lg:text-base truncate">${item.name}</p><p class="text-xs text-gray-500">₹${item.price} each</p></div>
                                <div class="flex items-center space-x-1 sm:space-x-2 flex-shrink-0">
                                    <button class="quantity-change-btn bg-stone-200 text-gray-700 w-7 h-7 rounded-full flex items-center justify-center font-bold text-lg hover:bg-stone-300 transition-colors" data-item-id="${item.id}" data-change="-1">-</button>
                                    <span class="font-semibold w-6 text-center text-sm lg:text-base">${item.quantity}</span>
                                    <button class="quantity-change-btn bg-stone-200 text-gray-700 w-7 h-7 rounded-full flex items-center justify-center font-bold text-lg hover:bg-stone-300 transition-colors" data-item-id="${item.id}" data-change="1">+</button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <div class="mt-auto pt-3 sm:pt-4">
                        <div class="pt-3 sm:pt-4 border-t border-gray-300">
                            <div class="flex justify-between text-base sm:text-lg font-medium mb-2">
                                <span>Total</span>
                                <span>₹${total.toFixed(0)}</span>
                            </div>
                        </div>
                        ${message ? `<div class="my-3 p-3 rounded-xl text-sm font-medium ${message.type === 'success' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">${message.text}</div>` : ''}
                        <button id="send-order-btn" ${items.length === 0 ? 'disabled' : ''} class="w-full mt-3 py-3 px-6 rounded-xl text-white font-semibold transition-all duration-300 bg-[#A40046] hover:bg-[#830038] focus:outline-none focus:ring-4 focus:ring-rose-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2">
                            <span id="send-order-text">Send Order</span>
                        </button>
                    </div>
                </aside>
            `;
        };

        const SearchModal = ({ isOpen }) => {
            if (!isOpen) return '';
            // Note: The internal state of this modal is handled by event listeners directly
            return `
                <div id="search-modal-overlay" class="fixed inset-0 bg-black/50 flex justify-center items-center z-50 p-2">
                    <div class="bg-white p-4 sm:p-6 rounded-2xl shadow-2xl w-full max-w-lg max-h-[85vh] flex flex-col">
                        <div class="flex justify-between items-center mb-3 sm:mb-4">
                            <h3 class="text-lg sm:text-xl lg:text-2xl royal-font font-semibold text-gray-800">Search Menu</h3>
                            <button id="search-modal-close" class="p-2 rounded-full hover:bg-gray-100 transition-colors">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg>
                            </button>
                        </div>
                        <input type="text" id="search-input" placeholder="Search for dishes..." class="bg-white border-2 border-gray-200 text-gray-800 text-base p-3 rounded-xl w-full transition-all duration-300 font-medium focus:outline-none focus:border-pink-500 focus:ring-2 focus:ring-pink-200" />
                        <div id="search-content" class="flex-grow overflow-y-auto mt-4"></div>
                        <div class="flex space-x-2 mt-4">
                            <button id="perform-search-btn" class="flex-1 bg-[#A40046] text-white px-6 py-3 rounded-lg font-medium shadow-md hover:bg-[#830038] transition-colors">Search</button>
                            <button id="clear-search-input-btn" class="bg-gray-500 text-white px-6 py-3 rounded-lg font-medium hover:bg-gray-600 transition-colors">Clear</button>
                        </div>
                    </div>
                </div>
            `;
        };
        
        const FloatingCategoryButton = ({ isVisible }) => `
            <button id="floating-category-btn" class="fixed bottom-8 right-6 z-40 w-14 h-14 bg-[#A40046] text-white rounded-full flex items-center justify-center shadow-lg transform transition-all duration-300 ease-in-out hover:bg-[#830038] hover:scale-110 focus:outline-none focus:ring-4 focus:ring-rose-300 lg:hidden ${isVisible ? 'opacity-100 translate-y-0' : 'opacity-0 translate-y-10 pointer-events-none'}">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg>
            </button>
        `;

        const FloatingCartButton = ({ isVisible, cartCount }) => `
            <button id="floating-cart-btn" class="fixed bottom-28 right-6 z-40 w-14 h-14 bg-white text-[#A40046] rounded-full flex items-center justify-center shadow-lg transform transition-all duration-300 ease-in-out hover:bg-gray-100 hover:scale-110 focus:outline-none focus:ring-4 focus:ring-pink-200 lg:hidden ${isVisible ? 'opacity-100 translate-y-0' : 'opacity-0 translate-y-10 pointer-events-none'}">
                <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path></svg>
                ${cartCount > 0 ? `<span class="absolute -top-1 -right-1 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-white transform bg-rose-600 rounded-full">${cartCount}</span>` : ''}
            </button>
        `;
        
        // --- LOGIC FUNCTIONS ---
        
        function handleFilterMenu(category) {
            state.activeCategory = category;
            state.searchResults = null;
            state.searchQueryDisplay = '';
            renderApp();
        }
        
        function handleSearch(query) {
            const lowerCaseQuery = query.toLowerCase();
            state.searchQueryDisplay = query;
            state.searchResults = MENU.filter(item => 
                item.name.toLowerCase().includes(lowerCaseQuery) ||
                item.description.toLowerCase().includes(lowerCaseQuery) ||
                (item.searchTerms && item.searchTerms.some(term => term.toLowerCase().includes(lowerCaseQuery)))
            );
            state.isSearchOpen = false;
            renderApp();
        }
        
        function clearSearch() {
            state.searchResults = null;
            state.searchQueryDisplay = '';
            handleFilterMenu(state.activeCategory);
        }

        function addToCart(itemId) {
            state.orderJustSent = false;
            const item = MENU.find(i => i.id === itemId);
            if (!item) return;

            const existingItem = state.cart[itemId];
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                state.cart[itemId] = { ...item, quantity: 1 };
            }
            
            renderApp();
        }
        
        function changeQuantity(itemId, change) {
            const item = state.cart[itemId];
            if (!item) return;
            item.quantity += change;
            if (item.quantity <= 0) {
                delete state.cart[itemId];
            }
            renderApp();
        }
        
        async function sendOrder() {
            const items = Object.values(state.cart);
            if (items.length === 0) {
                state.message = { text: 'Your cart is empty.', type: 'error' };
                renderApp();
                return;
            }
            if (!state.tableNumber) {
                state.message = { text: 'Please select a table number.', type: 'error' };
                renderApp();
                return;
            }

            document.getElementById('send-order-text').innerHTML = `
                <svg class="w-5 h-5 animate-spin" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <span>Sending...</span>
            `;
            document.getElementById('send-order-btn').disabled = true;

            const total = items.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const orderNumber = `C-${Date.now().toString().slice(-6)}`;
            const orderTime = new Date().toLocaleTimeString('en-IN', { hour: '2-digit', minute: '2-digit' });
            
            const orderData = {
                orderNumber,
                tableNumber: state.tableNumber,
                items,
                total,
                orderTime,
                timestamp: new Date().toISOString(),
            };
            
            try {
                if (GOOGLE_APPS_SCRIPT_URL.includes('YOUR_GOOGLE_APPS_SCRIPT_URL_HERE')) {
                    console.error("Please replace 'YOUR_GOOGLE_APPS_SCRIPT_URL_HERE' in the script.");
                    throw new Error("Google Apps Script URL is not configured.");
                }
                
                const response = await fetch(GOOGLE_APPS_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    body: JSON.stringify(orderData),
                });
                
                state.message = { text: `Order ${orderNumber} for Table ${state.tableNumber} sent!`, type: 'success' };
                state.previousOrder = orderData;
                localStorage.setItem('previousOrder', JSON.stringify(orderData));
                state.cart = {};
                state.orderJustSent = true;
                state.tableNumber = TABLE_NUMBERS[0] || '';

            } catch (error) {
                console.error('Error sending order:', error);
                state.message = { text: 'Failed to send order. Please try again.', type: 'error' };
            } finally {
                renderApp();
            }
        }


        // --- MAIN RENDER LOGIC ---

        function renderApp() {
            const cartCount = Object.values(state.cart).reduce((sum, item) => sum + item.quantity, 0);
            
            let filteredMenu = MENU;
            if (state.activeCategory !== 'All') {
                filteredMenu = MENU.filter(item => item.category === state.activeCategory);
            }

            root.innerHTML = `
                <div class="relative z-10 min-h-screen">
                    ${Header({ tableNumber: state.tableNumber, cartCount })}
                    <main class="container mx-auto px-2 sm:px-4 lg:px-8 mt-4 sm:mt-6 lg:mt-8 grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-6 lg:gap-8 text-white">
                        ${MenuSection({ activeCategory: state.activeCategory, searchResults: state.searchResults, searchQueryDisplay: state.searchQueryDisplay, filteredMenu })}
                        ${CartSidebar({ isOpen: state.isCartOpen, cart: state.cart, previousOrder: state.previousOrder, message: state.message, orderJustSent: state.orderJustSent })}
                    </main>
                    ${SearchModal({ isOpen: state.isSearchOpen })}
                    ${CategoryModal({ isOpen: state.isCategoryModalOpen, activeCategory: state.activeCategory })}
                    ${FloatingCategoryButton({ isVisible: state.isFloatingCategoryButtonVisible })}
                    ${FloatingCartButton({ isVisible: state.isFloatingCartButtonVisible, cartCount })}
                </div>
            `;
            
            attachEventListeners();

            if (state.message) {
                 setTimeout(() => {
                    state.message = null;
                    renderApp();
                 }, 5000);
            }
        }
        
        function attachEventListeners() {
            // Header
            document.getElementById('table-number-select')?.addEventListener('change', e => {
                state.tableNumber = e.target.value;
            });
            document.getElementById('search-btn')?.addEventListener('click', () => {
                state.isSearchOpen = true;
                renderApp();
            });
            document.getElementById('cart-btn')?.addEventListener('click', () => {
                state.isCartOpen = !state.isCartOpen;
                renderApp();
            });
            
            // Menu Section
            document.querySelectorAll('.add-to-cart-btn').forEach(btn => {
                btn.addEventListener('click', () => addToCart(parseInt(btn.dataset.itemId)));
            });
            document.getElementById('clear-search-btn')?.addEventListener('click', clearSearch);
            document.getElementById('category-modal-trigger')?.addEventListener('click', () => {
                state.isCategoryModalOpen = true;
                renderApp();
            });

            // Cart Sidebar
            document.getElementById('cart-close-btn')?.addEventListener('click', () => {
                state.isCartOpen = false;
                renderApp();
            });
            document.querySelectorAll('.quantity-change-btn').forEach(btn => {
                btn.addEventListener('click', () => changeQuantity(parseInt(btn.dataset.itemId), parseInt(btn.dataset.change)));
            });
            document.getElementById('send-order-btn')?.addEventListener('click', sendOrder);
            
            // Search Modal
            const searchModalOverlay = document.getElementById('search-modal-overlay');
            if (searchModalOverlay) {
                searchModalOverlay.addEventListener('click', () => {
                    state.isSearchOpen = false;
                    renderApp();
                });
                searchModalOverlay.querySelector('div').addEventListener('click', e => e.stopPropagation());
                document.getElementById('search-modal-close').addEventListener('click', () => {
                    state.isSearchOpen = false;
                    renderApp();
                });
                document.getElementById('perform-search-btn').addEventListener('click', () => {
                    const query = document.getElementById('search-input').value;
                    handleSearch(query);
                });
                document.getElementById('search-input').addEventListener('input', handleSearchInput);
                document.getElementById('clear-search-input-btn').addEventListener('click', () => {
                     document.getElementById('search-input').value = '';
                     handleSearchInput();
                });
                handleSearchInput(); // Initialize the search modal content
            }

            // Category Modal
            const categoryModalOverlay = document.getElementById('category-modal-overlay');
            if(categoryModalOverlay) {
                categoryModalOverlay.addEventListener('click', () => {
                    state.isCategoryModalOpen = false;
                    renderApp();
                });
                categoryModalOverlay.querySelector('div').addEventListener('click', e => e.stopPropagation());
                document.getElementById('category-modal-close').addEventListener('click', () => {
                    state.isCategoryModalOpen = false;
                    renderApp();
                });
                document.querySelectorAll('.category-select-item').forEach(item => {
                    item.addEventListener('click', () => {
                        handleFilterMenu(item.dataset.category);
                        state.isCategoryModalOpen = false;
                    });
                });
            }

            // Floating Buttons
            document.getElementById('floating-category-btn')?.addEventListener('click', () => {
                 state.isCategoryModalOpen = true;
                 renderApp();
            });
            document.getElementById('floating-cart-btn')?.addEventListener('click', () => {
                 state.isCartOpen = true;
                 renderApp();
            });
        }
        
        // Search Modal specific logic
        function handleSearchInput() {
            const searchInput = document.getElementById('search-input');
            if (!searchInput) return;

            const query = searchInput.value.toLowerCase();
            const contentEl = document.getElementById('search-content');
            if (!contentEl) return;
            
            if (query.length === 0) {
                contentEl.innerHTML = `
                    <div>
                        <h4 class="text-sm font-semibold text-gray-700 mb-2">Popular Searches:</h4>
                        <div class="flex flex-wrap gap-2">
                            ${popularSearches.map(term => `<span class="popular-search-tag inline-block bg-pink-100 text-pink-700 px-3 py-1 rounded-full text-sm font-medium cursor-pointer hover:bg-pink-200 transition-colors" data-term="${term}">${term}</span>`).join('')}
                        </div>
                    </div>
                `;
                document.querySelectorAll('.popular-search-tag').forEach(tag => {
                    tag.addEventListener('click', () => {
                        searchInput.value = tag.dataset.term;
                        handleSearchInput();
                    });
                });
                return;
            }

            if (query.length >= 2) {
                 const results = MENU.filter(item => 
                    item.name.toLowerCase().includes(query) ||
                    item.description.toLowerCase().includes(query) ||
                    (item.searchTerms && item.searchTerms.some(t => t.toLowerCase().includes(query)))
                );
                
                if (results.length > 0) {
                    contentEl.innerHTML = `
                        <div class="space-y-3">
                            ${results.map(item => `
                                <div class="flex items-center gap-3 p-3 bg-white rounded-lg border border-gray-200 hover:border-pink-300 hover:shadow-sm transition-all duration-200">
                                    <div class="flex-1 min-w-0">
                                        <div class="font-semibold royal-font text-[#A40046] text-base">${item.name}</div>
                                        <div class="text-xs text-gray-500 line-clamp-1">${item.description}</div>
                                    </div>
                                    <div class="font-bold text-gray-800 text-lg font-sans"><span class="text-sm align-middle">₹</span>${item.price}</div>
                                    <button class="modal-add-btn bg-[#A40046] text-white px-4 py-1.5 rounded-full text-xs font-semibold hover:bg-[#830038] transition transform hover:scale-105" data-item-id="${item.id}">Add</button>
                                </div>
                            `).join('')}
                        </div>
                    `;
                    document.querySelectorAll('.modal-add-btn').forEach(btn => {
                        btn.addEventListener('click', () => {
                            addToCart(parseInt(btn.dataset.itemId));
                            state.isSearchOpen = false;
                        });
                    });

                } else {
                    contentEl.innerHTML = `<p class="text-center text-gray-500 p-4">No results for "${query}"</p>`;
                }
            } else {
                 const suggestions = searchSuggestions.filter(s => s.toLowerCase().includes(query)).slice(0, 8);
                 if (suggestions.length > 0) {
                    contentEl.innerHTML = `
                        <div class="border-t pt-2">
                             ${suggestions.map(s => `<div class="suggestion-item p-3 flex items-center gap-3 rounded-lg hover:bg-gray-50 cursor-pointer" data-term="${s}">
                                <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                                <span class="text-gray-700">${s.replace(new RegExp(query, 'gi'), `<span class="font-bold text-pink-700">$&</span>`)}</span>
                             </div>`).join('')}
                        </div>
                    `;
                    document.querySelectorAll('.suggestion-item').forEach(item => {
                        item.addEventListener('click', () => {
                            searchInput.value = item.dataset.term;
                            handleSearchInput();
                        });
                    });
                 } else {
                    contentEl.innerHTML = '';
                 }
            }
        }
        
        // --- INITIALIZATION ---
        
        function main() {
            // Initial Splash Screen
            root.innerHTML = SplashScreen();
            setTimeout(() => {
                state.showSplash = false;
                renderApp();
            }, 2000);
            
            // Scroll listener for floating buttons
            window.addEventListener('scroll', () => {
                const shouldBeVisible = window.scrollY > 200;
                if (state.isFloatingCategoryButtonVisible !== shouldBeVisible || state.isFloatingCartButtonVisible !== shouldBeVisible) {
                    state.isFloatingCategoryButtonVisible = shouldBeVisible;
                    state.isFloatingCartButtonVisible = shouldBeVisible;
                    renderApp();
                }
            });
        }
        
        main();

    </script>
<script type="module" src="/index.tsx"></script>
</body>
</html>
